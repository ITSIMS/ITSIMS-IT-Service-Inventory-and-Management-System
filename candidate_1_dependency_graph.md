# Кандидат 1: Граф зависимостей IT-сервисов

## Описание модуля

Модуль **«Управление связями между сервисами»** отвечает за установление, хранение, визуализацию и удаление однонаправленных зависимостей между IT-сервисами в системе ITSIMS.

Связь фиксирует, что один сервис **использует** другой для своей работы. Совокупность всех связей образует **ориентированный граф зависимостей**, который визуализируется в интерактивном виде с помощью библиотеки React Flow.

---

## Почему этот модуль уникален

1. **Теория графов в продакшене.** В основе модуля лежит ориентированный граф: узлы — IT-сервисы, рёбра — зависимости. Это не типовой CRUD, а алгоритмическая задача с обнаружением циклов, обходом графа и каскадной логикой
2. **Визуализация данных.** Граф отображается интерактивно (zoom, pan, клик по узлу → переход к сервису). Это отдельная область тестирования — корректность layout, рендеринга, интерактивности
3. **Сквозная цепочка.** Модуль затрагивает все слои архитектуры: база данных → backend API → frontend визуализация. Верификация покрывает каждый из них
4. **Нетипичность для учебных проектов.** Подавляющее большинство веб-приложений на потоке — это CRUD-системы. Граф зависимостей выходит за рамки стандартного набора и требует специфических методов тестирования

---

## Покрытие требованиями

### Техническое задание (ТЗ)

| ID | Требование |
| --- | --- |
| TS-F013 | Установление однонаправленной связи между IT-сервисами администратором системы |
| TS-F014 | Фиксация направления связи от использующего сервиса к используемому |
| TS-F015 | Просмотр связей IT-сервиса с глубиной один уровень для специалистов по обслуживанию |
| TS-F016 | Визуализация связей между IT-сервисами в виде графа зависимостей |
| TS-F017 | Удаление связи между IT-сервисами администратором системы |

**Приоритет по MoSCoW:** Could have (опционально) — это дополнительная ценность, что делает модуль ещё более интересным для верификации: мы покажем, что даже опциональная функциональность верифицируется качественно.

### Системные требования (SR)

| ID | Требование |
| --- | --- |
| SR-F036 | Установление однонаправленной связи между двумя IT-сервисами |
| SR-F037 | Фиксация направления связи от использующего к используемому |
| SR-F038 | Удаление связи между IT-сервисами |
| SR-F039 | Просмотр связей с глубиной один уровень для специалистов по обслуживанию |
| SR-F040 | Визуализация связей в виде графа для администраторов и специалистов |
| SR-F041 | Интерактивное взаимодействие с графом: выбор узла и переход к сервису |

### Требования к ПО (SWR)

| ID | Требование |
| --- | --- |
| SWR-API080 | `GET /api/v1/services/{id}/dependencies` — получение связей сервиса |
| SWR-API081 | Для специалистов — связи с глубиной 1 уровень |
| SWR-API082 | Для администраторов — полный граф связей |
| SWR-API083 | Формат ответа: `{ depends_on: [...], used_by: [...] }` |
| SWR-API084 | `POST /api/v1/services/{id}/dependencies` — создание связи |
| SWR-API085 | Блокировка циклических зависимостей (HTTP 400) |
| SWR-API086 | `DELETE /api/v1/services/{id}/dependencies/{id}` — удаление связи |
| SWR-API087 | `GET /api/v1/dependencies/graph` — полный граф в формате React Flow |
| SWR-DB012 | Таблица `service_dependencies` (service_id, depends_on_id) |
| SWR-DB013 | Уникальный индекс `unique(service_id, depends_on_id)` |
| SWR-UI026 | Компонент DependencyGraph на React Flow |
| SWR-UI027 | Поддержка zoom, pan, автоматическое расположение узлов |
| SWR-UI028 | Клик по узлу → переход на страницу сервиса |

### Трассировка в цепочке

```
TS-F013..TS-F017  →  SR-F036..SR-F041  →  SWR-API080..SWR-API087
                                           SWR-DB012, SWR-DB013
                                           SWR-UI026..SWR-UI028
```

---

## План верификации

### 1. Формальная инспекция требований

- Инспекция TS-F013 — TS-F017: полнота, непротиворечивость, тестируемость
- Инспекция SR-F036 — SR-F041: соответствие ТЗ, отсутствие пропусков
- Инспекция SWR-API080 — SWR-API087: корректность спецификации API
- Проверка трассируемости: каждое требование ТЗ раскрыто на уровне SR и SWR

### 2. Unit-тестирование (Backend)

| Тест-кейс | Описание | Ожидание |
| --- | --- | --- |
| Создание связи | POST с валидными service_id и depends_on_id | HTTP 201, связь создана |
| Дублирование связи | POST с уже существующей парой | HTTP 409 или HTTP 400 |
| Циклическая зависимость | A→B, затем B→A | HTTP 400, цикл заблокирован |
| Транзитивный цикл | A→B→C, затем C→A | HTTP 400, цикл заблокирован |
| Самозависимость | service_id = depends_on_id | HTTP 400 |
| Удаление связи | DELETE существующей связи | HTTP 200, связь удалена |
| Удаление несуществующей | DELETE с невалидным ID | HTTP 404 |
| Связи сервиса (глубина 1) | GET для специалиста | Только непосредственные зависимости |
| Полный граф | GET /dependencies/graph | Все узлы и рёбра |
| Каскадное удаление | Удаление сервиса с зависимостями | Все связи удалены |

### 3. Интеграционное тестирование (API)

- Сценарий: создание сервисов A, B, C → установка связей A→B, B→C → проверка графа → удаление B → проверка очистки связей
- Тестирование прав доступа: только администратор системы может создавать/удалять связи
- Тестирование формата ответа на соответствие SWR-API083 и SWR-API087

### 4. UI-тестирование (Frontend)

| Тест-кейс | Описание |
| --- | --- |
| Рендеринг графа | Граф отображается с правильным количеством узлов и рёбер |
| Направление рёбер | Стрелки направлены от использующего к используемому |
| Zoom и pan | Масштабирование и перемещение работают корректно |
| Клик по узлу | Переход на страницу соответствующего сервиса |
| Пустой граф | Корректное отображение при отсутствии связей |
| Большой граф | Корректный layout при 50+ узлах и 100+ рёбрах |

### 5. Нагрузочное тестирование

- Граф из 2000 сервисов и 5000 связей: время построения < 2 с
- Обнаружение цикла в графе из 1000 узлов: время ответа < 0.5 с
- Одновременное создание связей несколькими пользователями

---

## Затрагиваемые компоненты системы

| Слой | Компонент | Технология |
| --- | --- | --- |
| База данных | Таблица `service_dependencies` | PostgreSQL 16 |
| Backend | Модуль `dependencies` (4 endpoints) | FastAPI, SQLAlchemy |
| Frontend | Компонент `DependencyGraph` | React, React Flow 11 |
| Алгоритмы | Обнаружение циклов, обход графа | Python (DFS/BFS) |

---

## Оценка кандидата

### Плюсы выбора

- **Алгоритмическая нетривиальность** — обнаружение циклов, обход графа, каскадные операции
- **Полное покрытие слоёв** — от БД до UI, включая алгоритмы
- **Чёткие границы модуля** — 5 требований ТЗ, 6 SR, 13 SWR — компактно и управляемо
- **Богатство тест-кейсов** — граничные случаи, негативные сценарии, нагрузка
- **Уникальность** — ни один другой проект на потоке не будет верифицировать граф зависимостей
- **Визуальная компонента** — тестирование интерактивной визуализации добавляет глубину

### Минусы выбора

- **Приоритет Could have** — модуль не является обязательным для первой версии, что может вызвать вопрос «зачем верифицировать опциональное?»
- **Зависимость от React Flow** — часть тестирования упирается в стороннюю библиотеку, поведение которой мы не контролируем
- **Относительно малое количество требований** — 5 требований ТЗ может показаться недостаточным объёмом для масштабной верификации
- **Сложность нагрузочного тестирования** — для полноценного тестирования графа на 2000 узлов нужна генерация тестовых данных
